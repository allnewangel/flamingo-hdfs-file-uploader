<?xml version="1.0" encoding="UTF-8"?>
<flamingo xmlns="http://www.openflamingo.org/schema/uploader"
          xsi:schemaLocation="http://www.openflamingo.org/schema/uploader flamingo-uploader-1.0.xsd"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<description>서울시 공공 데이터 배치 업로드</description>

	<clusters>
		<cluster name="dev" description="개발 클러스터">
			<fs.default.name>hdfs://14.63.215.20:9000</fs.default.name>
			<mapred.job.tracker>14.63.215.20:9001</mapred.job.tracker>
			<properties>
				<property name="mapred.maximum.map.task" value="100"/>
			</properties>
		</cluster>
	</clusters>

	<globalVariables>
		<globalVariable name="currentDate" value="${dateFormat('yyyyMMdd')}" description="string"/>
	</globalVariables>

	<job name="Seoul_Rain" description="서울시 공공 데이터 - 강수량 데이터 수집 Job">
		<schedule>
			<cronExpression>* * * * * ?</cronExpression>
			<start datePattern="yyyyMMdd" date="${currentDate}"/>
			<end datePattern="yyyyMMdd" date="${tommorow('yyyyMMdd')}"/>
		</schedule>
		<policy>
			<ingress>
				<local>
					<sourceDirectory conditionType="antPattern">
						<path>${user.dir}/target/uploader/in</path>
						<condition>rain_*.txt</condition>
					</sourceDirectory>
					<workingDirectory>${user.dir}/target/uploader/work</workingDirectory>
					<completeDirectory>${user.dir}/target/uploader/complete</completeDirectory>
					<removeAfterCopy>false</removeAfterCopy>
					<errorDirectory>${user.dir}/target/uploader/error</errorDirectory>
				</local>
			</ingress>
			<outgress>
				<hdfs cluster="dev">
					<path>/helloworld</path>
				</hdfs>
			</outgress>
		</policy>
	</job>
</flamingo>